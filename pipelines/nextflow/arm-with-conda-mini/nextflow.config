// Nextflow configuration file

// Pipeline metadata
manifest {
    name = 'minimal-conda-pipeline'
    description = 'Minimal Nextflow pipeline using Conda'
    version = '1.0.0'
    nextflowVersion = '>=22.10.0'
}

// Enable Conda
conda {
    enabled = true
    createTimeout = '30 min'
    useMamba = false  // Use conda instead of mamba for compatibility
}

// Process configuration
process {
    // Default Conda environment for all processes
    conda = 'environment.yml'

    // Resource requirements
    cpus = 2
    memory = '4 GB'
    time = '1 h'

    // Capture process logs
    errorStrategy = 'retry'
    maxRetries = 1

    // Process-specific configurations
    withName: FASTA_STATS {
        cpus = 1
        memory = '2 GB'
    }

    withName: COUNT_SEQUENCES {
        cpus = 1
        memory = '1 GB'
    }

    withName: SUMMARY_REPORT {
        cpus = 1
        memory = '1 GB'
    }
}

// Execution profiles
profiles {
    standard {
        process.executor = 'local'
        process.cpus = 2
        process.memory = '4 GB'
    }
    
    mac {
        process.executor = 'local'
        process.cpus = 4
        process.memory = '8 GB'
        conda.createTimeout = '5 min'
    }
    
    debug {
        process.executor = 'local'
        process.cpus = 1
        process.memory = '2 GB'
        cleanup = false  // Keep work directories for debugging
    }
}

// Default parameters
params {
    input = "test_data/*.fasta"
    outdir = "results"
    logsdir = "logs"
    help = false
}

// Logging configuration
env {
    NXF_LOG_FILE = "${params.logsdir}/.nextflow.log"
}

// Report configuration
report {
    enabled = true
    file = "${params.logsdir}/pipeline_report.html"
    overwrite = true
}

timeline {
    enabled = true
    file = "${params.logsdir}/timeline.html"
    overwrite = true
}

trace {
    enabled = true
    file = "${params.logsdir}/trace.txt"
    overwrite = true
}
